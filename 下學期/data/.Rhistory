#https://covid-19.nchc.org.tw/dt_owl.php?dt_name=4......
#全球報表\亞洲\日本\EXCEL
#另存新檔、逗點空白分格，並將數字存成儲存數字格式,不要有小數點
library(ggplot2)#R數據視覺化下載
library(scales)#下載scales
library(lubridate)
library(stringr)
options(scipen = 999)
setwd("/Users/jeremyhsieh/Documents/R/下學期/data")
dir()
COVID_19=read.csv("owl_world_gbr.csv", fileEncoding = "UTF-8-BOM")
COVID_19_vac=read.csv("owl_world_gbr_vac.csv", fileEncoding = "UTF-8-BOM")#下載疫苗覆蓋率
# View(COVID_19)
# View(COVID_19_vac)#查看疫苗覆蓋欄位
names(COVID_19)#查看欄位名稱
COVID_19_part<-COVID_19[,c("X.3","X.4","X.5",
"X.6","X.7","X.26")]#保留欄位
COVID_19_vac_part<-COVID_19_vac[,c("X.2","X.10","X.11","X.12")]#保留日期、打一劑、二劑、三劑比例欄位
View(COVID_19_part)
View(COVID_19_vac_part)
names(COVID_19_part)<-c("date","total_vaccination","daily_vaccination",
"daily_vaccination_avg","die","population")
names(COVID_19_vac_part)<-c("date","people_vaccinated_per_hundred",
"people_fully_vaccinated_per_hundred",
"total_boosters_per_hundred")
COVID_19_part<-COVID_19_part[-1,]#刪除第一欄
COVID_19_vac_part<-COVID_19_vac_part[-1,]#刪除第一欄
# View(COVID_19_part)#再檢查欄位
# View(COVID_19_vac_part)#再檢查欄位
str(COVID_19_part)
str(COVID_19_vac_part)
COVID_19_part<-merge(COVID_19_part,COVID_19_vac_part,all=TRUE) #聯集合併
View(COVID_19_part)
str(COVID_19_part)
# #將格式改成日期格式及數字格式
COVID_19_part$date<-as.character(COVID_19_part$date)
COVID_19_part$date<-strptime(COVID_19_part$date,
"%Y-%m-%d",
tz=Sys.timezone())
COVID_19_part$date<-as.POSIXct(COVID_19_part$date)
COVID_19_part[4]
COVID_19_part$total_vaccination<-as.character(COVID_19_part$total_vaccination)#
COVID_19_part$daily_vaccination<-as.character(COVID_19_part$daily_vaccination)#
COVID_19_part$daily_vaccination_avg<-as.character(COVID_19_part$daily_vaccination_avg)#
COVID_19_part$die<-as.character(COVID_19_part$die)
COVID_19_part$population<-as.character(COVID_19_part$population)
COVID_19_part$people_vaccinated_per_hundred<-as.character(COVID_19_part$people_vaccinated_per_hundred)
COVID_19_part$people_fully_vaccinated_per_hundred<-as.character(COVID_19_part$people_fully_vaccinated_per_hundred)
COVID_19_part$total_boosters_per_hundred<-as.character(COVID_19_part$total_boosters_per_hundred)
COVID_19_part$total_vaccination<-as.numeric(gsub(",","", COVID_19_part$total_vaccination))#
COVID_19_part$daily_vaccination<-as.numeric(gsub(",","", COVID_19_part$daily_vaccination))#
COVID_19_part$daily_vaccination_avg<-as.numeric(gsub(",","", COVID_19_part$daily_vaccination_avg))#
COVID_19_part$die<-as.numeric(gsub(",","", COVID_19_part$die))
COVID_19_part$population<-as.numeric(gsub(",","", COVID_19_part$population))
COVID_19_part$people_vaccinated_per_hundred<-as.numeric(gsub(",","", COVID_19_part$people_vaccinated_per_hundred))
COVID_19_part$people_fully_vaccinated_per_hundred<-as.numeric(gsub(",","", COVID_19_part$people_fully_vaccinated_per_hundred))
COVID_19_part$total_boosters_per_hundred<-as.numeric(gsub(",","", COVID_19_part$total_boosters_per_hundred))
str(COVID_19_part)#檢查格式正確與否
View(COVID_19_part)
COVID_19_part_2022<-subset(COVID_19_part,date<="2021-02-01 CST"
&date>="2022-02-01 CST")
View(COVID_19_part_2022)#最新的日期的資料
##劃圖累計
dev.new()
ggplot()+
geom_line(data=COVID_19_part_2022,#data.frame的資料
aes(x=date,y=daily_vaccination,
colour = "daily_vaccination"),size=1)+#折線
geom_line(data=COVID_19_part_2022,#data.frame的資料
aes(x=date,y=daily_vaccination_avg,
colour = "daily_vaccination_avg"),size=1)+
theme_bw()+
annotate("text" #標籤
,COVID_19_part_2022$date[which.min(COVID_19_part_2022$daily_vaccination_avg)]#自動找出最低的「七日平均新增確診」
,y=COVID_19_part_2022$daily_vaccination_avg[which.min(COVID_19_part_2022$daily_vaccination_avg)] # 自動找出最低「七日平均新增確診」y軸位置
,label=paste(COVID_19_part_2022$date[which.min(COVID_19_part_2022$daily_vaccination_avg)]
,"Lo"
,COVID_19_part_2022$daily_vaccination_avg[which.min(COVID_19_part_2022$daily_vaccination_avg)])
,colour="blue",size=3,vjust=1.5)+
annotate("text" #標籤
,COVID_19_part_2022$date[which.max(COVID_19_part_2022$daily_vaccination_avg)]#自動找出最高的「七日平均新增確診」
,y=COVID_19_part_2022$daily_vaccination_avg[which.max(COVID_19_part_2022$daily_vaccination_avg)] # 自動找出最高「七日平均新增確診」y軸位置
,label=paste(COVID_19_part_2022$date[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,"hi "
,COVID_19_part_2022$daily_vaccination_avg[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,"\n"
,"1st dose"
,COVID_19_part_2022$people_vaccinated_per_hundred[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,"%\n"
,"2nd dose"
,COVID_19_part_2022$people_fully_vaccinated_per_hundred[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,"%\n"
,"3rd dose"
,COVID_19_part_2022$total_boosters_per_hundred[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,"%\n"
,"accumlated comfirmed \namount at that time\n"
,round(COVID_19_part_2022$total_vaccination[which.max(COVID_19_part_2022$daily_vaccination_avg)]/
COVID_19_part_2022$population[which.max(COVID_19_part_2022$daily_vaccination_avg)],4)*100
,"%")
,colour="black",size=3,vjust=-1.0, hjust = 1)+
annotate("rect" #最低七日平均確診，到最高七日平均確診區間
,xmin=COVID_19_part_2022$date[which.min(COVID_19_part_2022$daily_vaccination_avg)]
,xmax=COVID_19_part_2022$date[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,ymin=COVID_19_part_2022$daily_vaccination_avg[which.min(COVID_19_part_2022$daily_vaccination_avg)]
,ymax=COVID_19_part_2022$daily_vaccination_avg[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,alpha=0.1,fill="blue")+
annotate("segment"
,x=COVID_19_part_2022$date[which.min(COVID_19_part_2022$daily_vaccination_avg)]
,xend=COVID_19_part_2022$date[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,y=COVID_19_part_2022$daily_vaccination_avg[which.min(COVID_19_part_2022$daily_vaccination_avg)]
,yend=COVID_19_part_2022$daily_vaccination_avg[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,size=2,colour="yellow",arrow=arrow())+
ggtitle(paste("UK 2022 COVDI-19 "
,"daily_vaccination_avg"
,"Low to High increase"
,round(
COVID_19_part_2022$daily_vaccination_avg[which.max(COVID_19_part_2022$daily_vaccination_avg)]/
COVID_19_part_2022$daily_vaccination_avg[which.min(COVID_19_part_2022$daily_vaccination_avg)]-1,0)
,"times\n"
,"duration"
,interval(start = COVID_19_part_2022$date[which.min(COVID_19_part_2022$daily_vaccination_avg)]
,end = COVID_19_part_2022$date[which.max(COVID_19_part_2022$daily_vaccination_avg)]) / duration(num = 1, units = "days")
,"days"
,"current accumlated comfirmed amount"
,round(tail(COVID_19_part_2022$total_vaccination,1)/tail(COVID_19_part_2022$population,1),4)*100
,"%"))+
theme(plot.title = element_text(face="italic"
,colour = "red",hjust = 0.5,size = 15))#標題
#https://covid-19.nchc.org.tw/dt_owl.php?dt_name=4......
#全球報表\亞洲\日本\EXCEL
#另存新檔、逗點空白分格，並將數字存成儲存數字格式,不要有小數點
library(ggplot2)#R數據視覺化下載
library(scales)#下載scales
library(lubridate)
library(stringr)
options(scipen = 999)
setwd("/Users/jeremyhsieh/Documents/R/下學期/data")
dir()
COVID_19=read.csv("owl_world_gbr.csv", fileEncoding = "UTF-8-BOM")
COVID_19_vac=read.csv("owl_world_gbr_vac.csv", fileEncoding = "UTF-8-BOM")#下載疫苗覆蓋率
# View(COVID_19)
# View(COVID_19_vac)#查看疫苗覆蓋欄位
names(COVID_19)#查看欄位名稱
COVID_19_part<-COVID_19[,c("X.3","X.4","X.5",
"X.6","X.7","X.26")]#保留欄位
COVID_19_vac_part<-COVID_19_vac[,c("X.2","X.10","X.11","X.12")]#保留日期、打一劑、二劑、三劑比例欄位
View(COVID_19_part)
View(COVID_19_vac_part)
names(COVID_19_part)<-c("date","total_vaccination","daily_vaccination",
"daily_vaccination_avg","die","population")
names(COVID_19_vac_part)<-c("date","people_vaccinated_per_hundred",
"people_fully_vaccinated_per_hundred",
"total_boosters_per_hundred")
COVID_19_part<-COVID_19_part[-1,]#刪除第一欄
COVID_19_vac_part<-COVID_19_vac_part[-1,]#刪除第一欄
# View(COVID_19_part)#再檢查欄位
# View(COVID_19_vac_part)#再檢查欄位
str(COVID_19_part)
str(COVID_19_vac_part)
COVID_19_part<-merge(COVID_19_part,COVID_19_vac_part,all=TRUE) #聯集合併
View(COVID_19_part)
str(COVID_19_part)
# #將格式改成日期格式及數字格式
COVID_19_part$date<-as.character(COVID_19_part$date)
COVID_19_part$date<-strptime(COVID_19_part$date,
"%Y-%m-%d",
tz=Sys.timezone())
COVID_19_part$date<-as.POSIXct(COVID_19_part$date)
COVID_19_part[4]
COVID_19_part$total_vaccination<-as.character(COVID_19_part$total_vaccination)#
COVID_19_part$daily_vaccination<-as.character(COVID_19_part$daily_vaccination)#
COVID_19_part$daily_vaccination_avg<-as.character(COVID_19_part$daily_vaccination_avg)#
COVID_19_part$die<-as.character(COVID_19_part$die)
COVID_19_part$population<-as.character(COVID_19_part$population)
COVID_19_part$people_vaccinated_per_hundred<-as.character(COVID_19_part$people_vaccinated_per_hundred)
COVID_19_part$people_fully_vaccinated_per_hundred<-as.character(COVID_19_part$people_fully_vaccinated_per_hundred)
COVID_19_part$total_boosters_per_hundred<-as.character(COVID_19_part$total_boosters_per_hundred)
COVID_19_part$total_vaccination<-as.numeric(gsub(",","", COVID_19_part$total_vaccination))#
COVID_19_part$daily_vaccination<-as.numeric(gsub(",","", COVID_19_part$daily_vaccination))#
COVID_19_part$daily_vaccination_avg<-as.numeric(gsub(",","", COVID_19_part$daily_vaccination_avg))#
COVID_19_part$die<-as.numeric(gsub(",","", COVID_19_part$die))
COVID_19_part$population<-as.numeric(gsub(",","", COVID_19_part$population))
COVID_19_part$people_vaccinated_per_hundred<-as.numeric(gsub(",","", COVID_19_part$people_vaccinated_per_hundred))
COVID_19_part$people_fully_vaccinated_per_hundred<-as.numeric(gsub(",","", COVID_19_part$people_fully_vaccinated_per_hundred))
COVID_19_part$total_boosters_per_hundred<-as.numeric(gsub(",","", COVID_19_part$total_boosters_per_hundred))
str(COVID_19_part)#檢查格式正確與否
View(COVID_19_part)
COVID_19_part_2022<-subset(COVID_19_part,date<="2021-02-01 CST"
&date>="2021-12-31 CST")
View(COVID_19_part_2022)#最新的日期的資料
##劃圖累計
dev.new()
ggplot()+
geom_line(data=COVID_19_part_2022,#data.frame的資料
aes(x=date,y=daily_vaccination,
colour = "daily_vaccination"),size=1)+#折線
geom_line(data=COVID_19_part_2022,#data.frame的資料
aes(x=date,y=daily_vaccination_avg,
colour = "daily_vaccination_avg"),size=1)+
theme_bw()+
annotate("text" #標籤
,COVID_19_part_2022$date[which.min(COVID_19_part_2022$daily_vaccination_avg)]#自動找出最低的「七日平均新增確診」
,y=COVID_19_part_2022$daily_vaccination_avg[which.min(COVID_19_part_2022$daily_vaccination_avg)] # 自動找出最低「七日平均新增確診」y軸位置
,label=paste(COVID_19_part_2022$date[which.min(COVID_19_part_2022$daily_vaccination_avg)]
,"Lo"
,COVID_19_part_2022$daily_vaccination_avg[which.min(COVID_19_part_2022$daily_vaccination_avg)])
,colour="blue",size=3,vjust=1.5)+
annotate("text" #標籤
,COVID_19_part_2022$date[which.max(COVID_19_part_2022$daily_vaccination_avg)]#自動找出最高的「七日平均新增確診」
,y=COVID_19_part_2022$daily_vaccination_avg[which.max(COVID_19_part_2022$daily_vaccination_avg)] # 自動找出最高「七日平均新增確診」y軸位置
,label=paste(COVID_19_part_2022$date[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,"hi "
,COVID_19_part_2022$daily_vaccination_avg[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,"\n"
,"1st dose"
,COVID_19_part_2022$people_vaccinated_per_hundred[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,"%\n"
,"2nd dose"
,COVID_19_part_2022$people_fully_vaccinated_per_hundred[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,"%\n"
,"3rd dose"
,COVID_19_part_2022$total_boosters_per_hundred[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,"%\n"
,"accumlated comfirmed \namount at that time\n"
,round(COVID_19_part_2022$total_vaccination[which.max(COVID_19_part_2022$daily_vaccination_avg)]/
COVID_19_part_2022$population[which.max(COVID_19_part_2022$daily_vaccination_avg)],4)*100
,"%")
,colour="black",size=3,vjust=-1.0, hjust = 1)+
annotate("rect" #最低七日平均確診，到最高七日平均確診區間
,xmin=COVID_19_part_2022$date[which.min(COVID_19_part_2022$daily_vaccination_avg)]
,xmax=COVID_19_part_2022$date[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,ymin=COVID_19_part_2022$daily_vaccination_avg[which.min(COVID_19_part_2022$daily_vaccination_avg)]
,ymax=COVID_19_part_2022$daily_vaccination_avg[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,alpha=0.1,fill="blue")+
annotate("segment"
,x=COVID_19_part_2022$date[which.min(COVID_19_part_2022$daily_vaccination_avg)]
,xend=COVID_19_part_2022$date[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,y=COVID_19_part_2022$daily_vaccination_avg[which.min(COVID_19_part_2022$daily_vaccination_avg)]
,yend=COVID_19_part_2022$daily_vaccination_avg[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,size=2,colour="yellow",arrow=arrow())+
ggtitle(paste("UK 2022 COVDI-19 "
,"daily_vaccination_avg"
,"Low to High increase"
,round(
COVID_19_part_2022$daily_vaccination_avg[which.max(COVID_19_part_2022$daily_vaccination_avg)]/
COVID_19_part_2022$daily_vaccination_avg[which.min(COVID_19_part_2022$daily_vaccination_avg)]-1,0)
,"times\n"
,"duration"
,interval(start = COVID_19_part_2022$date[which.min(COVID_19_part_2022$daily_vaccination_avg)]
,end = COVID_19_part_2022$date[which.max(COVID_19_part_2022$daily_vaccination_avg)]) / duration(num = 1, units = "days")
,"days"
,"current accumlated comfirmed amount"
,round(tail(COVID_19_part_2022$total_vaccination,1)/tail(COVID_19_part_2022$population,1),4)*100
,"%"))+
theme(plot.title = element_text(face="italic"
,colour = "red",hjust = 0.5,size = 15))#標題
#https://covid-19.nchc.org.tw/dt_owl.php?dt_name=4......
#全球報表\亞洲\日本\EXCEL
#另存新檔、逗點空白分格，並將數字存成儲存數字格式,不要有小數點
library(ggplot2)#R數據視覺化下載
library(scales)#下載scales
library(lubridate)
library(stringr)
options(scipen = 999)
setwd("/Users/jeremyhsieh/Documents/R/下學期/data")
dir()
COVID_19=read.csv("owl_world_gbr.csv", fileEncoding = "UTF-8-BOM")
COVID_19_vac=read.csv("owl_world_gbr_vac.csv", fileEncoding = "UTF-8-BOM")#下載疫苗覆蓋率
# View(COVID_19)
# View(COVID_19_vac)#查看疫苗覆蓋欄位
names(COVID_19)#查看欄位名稱
COVID_19_part<-COVID_19[,c("X.3","X.4","X.5",
"X.6","X.7","X.26")]#保留欄位
COVID_19_vac_part<-COVID_19_vac[,c("X.2","X.10","X.11","X.12")]#保留日期、打一劑、二劑、三劑比例欄位
View(COVID_19_part)
View(COVID_19_vac_part)
names(COVID_19_part)<-c("date","total_vaccination","daily_vaccination",
"daily_vaccination_avg","die","population")
names(COVID_19_vac_part)<-c("date","people_vaccinated_per_hundred",
"people_fully_vaccinated_per_hundred",
"total_boosters_per_hundred")
COVID_19_part<-COVID_19_part[-1,]#刪除第一欄
COVID_19_vac_part<-COVID_19_vac_part[-1,]#刪除第一欄
# View(COVID_19_part)#再檢查欄位
# View(COVID_19_vac_part)#再檢查欄位
str(COVID_19_part)
str(COVID_19_vac_part)
COVID_19_part<-merge(COVID_19_part,COVID_19_vac_part,all=TRUE) #聯集合併
View(COVID_19_part)
str(COVID_19_part)
# #將格式改成日期格式及數字格式
COVID_19_part$date<-as.character(COVID_19_part$date)
COVID_19_part$date<-strptime(COVID_19_part$date,
"%Y-%m-%d",
tz=Sys.timezone())
COVID_19_part$date<-as.POSIXct(COVID_19_part$date)
COVID_19_part[4]
COVID_19_part$total_vaccination<-as.character(COVID_19_part$total_vaccination)#
COVID_19_part$daily_vaccination<-as.character(COVID_19_part$daily_vaccination)#
COVID_19_part$daily_vaccination_avg<-as.character(COVID_19_part$daily_vaccination_avg)#
COVID_19_part$die<-as.character(COVID_19_part$die)
COVID_19_part$population<-as.character(COVID_19_part$population)
COVID_19_part$people_vaccinated_per_hundred<-as.character(COVID_19_part$people_vaccinated_per_hundred)
COVID_19_part$people_fully_vaccinated_per_hundred<-as.character(COVID_19_part$people_fully_vaccinated_per_hundred)
COVID_19_part$total_boosters_per_hundred<-as.character(COVID_19_part$total_boosters_per_hundred)
COVID_19_part$total_vaccination<-as.numeric(gsub(",","", COVID_19_part$total_vaccination))#
COVID_19_part$daily_vaccination<-as.numeric(gsub(",","", COVID_19_part$daily_vaccination))#
COVID_19_part$daily_vaccination_avg<-as.numeric(gsub(",","", COVID_19_part$daily_vaccination_avg))#
COVID_19_part$die<-as.numeric(gsub(",","", COVID_19_part$die))
COVID_19_part$population<-as.numeric(gsub(",","", COVID_19_part$population))
COVID_19_part$people_vaccinated_per_hundred<-as.numeric(gsub(",","", COVID_19_part$people_vaccinated_per_hundred))
COVID_19_part$people_fully_vaccinated_per_hundred<-as.numeric(gsub(",","", COVID_19_part$people_fully_vaccinated_per_hundred))
COVID_19_part$total_boosters_per_hundred<-as.numeric(gsub(",","", COVID_19_part$total_boosters_per_hundred))
str(COVID_19_part)#檢查格式正確與否
View(COVID_19_part)
COVID_19_part_2022<-subset(COVID_19_part,date<="2021-02-01 CST"
&date>="2021-12-31 CST")
View(COVID_19_part_2022)#最新的日期的資料
##劃圖累計
dev.new()
ggplot()+
geom_line(data=COVID_19_part_2022,#data.frame的資料
aes(x=date,y=daily_vaccination,
colour = "daily_vaccination"),size=1)+#折線
geom_line(data=COVID_19_part_2022,#data.frame的資料
aes(x=date,y=daily_vaccination_avg,
colour = "daily_vaccination_avg"),size=1)+
theme_bw()+
annotate("text" #標籤
,COVID_19_part_2022$date[which.min(COVID_19_part_2022$daily_vaccination_avg)]#自動找出最低的「七日平均新增確診」
,y=COVID_19_part_2022$daily_vaccination_avg[which.min(COVID_19_part_2022$daily_vaccination_avg)] # 自動找出最低「七日平均新增確診」y軸位置
,label=paste(COVID_19_part_2022$date[which.min(COVID_19_part_2022$daily_vaccination_avg)]
,"Lo"
,COVID_19_part_2022$daily_vaccination_avg[which.min(COVID_19_part_2022$daily_vaccination_avg)])
,colour="blue",size=3,vjust=1.5)+
annotate("text" #標籤
,COVID_19_part_2022$date[which.max(COVID_19_part_2022$daily_vaccination_avg)]#自動找出最高的「七日平均新增確診」
,y=COVID_19_part_2022$daily_vaccination_avg[which.max(COVID_19_part_2022$daily_vaccination_avg)] # 自動找出最高「七日平均新增確診」y軸位置
,label=paste(COVID_19_part_2022$date[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,"hi "
,COVID_19_part_2022$daily_vaccination_avg[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,"\n"
,"1st dose"
,COVID_19_part_2022$people_vaccinated_per_hundred[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,"%\n"
,"2nd dose"
,COVID_19_part_2022$people_fully_vaccinated_per_hundred[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,"%\n"
,"3rd dose"
,COVID_19_part_2022$total_boosters_per_hundred[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,"%\n"
,"accumlated comfirmed \namount at that time\n"
,round(COVID_19_part_2022$total_vaccination[which.max(COVID_19_part_2022$daily_vaccination_avg)]/
COVID_19_part_2022$population[which.max(COVID_19_part_2022$daily_vaccination_avg)],4)*100
,"%")
,colour="black",size=3,vjust=-1.0, hjust = 1)+
annotate("rect" #最低七日平均確診，到最高七日平均確診區間
,xmin=COVID_19_part_2022$date[which.min(COVID_19_part_2022$daily_vaccination_avg)]
,xmax=COVID_19_part_2022$date[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,ymin=COVID_19_part_2022$daily_vaccination_avg[which.min(COVID_19_part_2022$daily_vaccination_avg)]
,ymax=COVID_19_part_2022$daily_vaccination_avg[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,alpha=0.1,fill="blue")+
annotate("segment"
,x=COVID_19_part_2022$date[which.min(COVID_19_part_2022$daily_vaccination_avg)]
,xend=COVID_19_part_2022$date[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,y=COVID_19_part_2022$daily_vaccination_avg[which.min(COVID_19_part_2022$daily_vaccination_avg)]
,yend=COVID_19_part_2022$daily_vaccination_avg[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,size=2,colour="yellow",arrow=arrow())+
ggtitle(paste("UK 2022 COVDI-19 "
,"daily_vaccination_avg"
,"Low to High increase"
,round(
COVID_19_part_2022$daily_vaccination_avg[which.max(COVID_19_part_2022$daily_vaccination_avg)]/
COVID_19_part_2022$daily_vaccination_avg[which.min(COVID_19_part_2022$daily_vaccination_avg)]-1,0)
,"times\n"
,"duration"
,interval(start = COVID_19_part_2022$date[which.min(COVID_19_part_2022$daily_vaccination_avg)]
,end = COVID_19_part_2022$date[which.max(COVID_19_part_2022$daily_vaccination_avg)]) / duration(num = 1, units = "days")
,"days"
,"current accumlated comfirmed amount"
,round(tail(COVID_19_part_2022$total_vaccination,1)/tail(COVID_19_part_2022$population,1),4)*100
,"%"))+
theme(plot.title = element_text(face="italic"
,colour = "red",hjust = 0.5,size = 15))#標題
#https://covid-19.nchc.org.tw/dt_owl.php?dt_name=4......
#全球報表\亞洲\日本\EXCEL
#另存新檔、逗點空白分格，並將數字存成儲存數字格式,不要有小數點
library(ggplot2)#R數據視覺化下載
library(scales)#下載scales
library(lubridate)
library(stringr)
options(scipen = 999)
setwd("/Users/jeremyhsieh/Documents/R/下學期/data")
dir()
COVID_19=read.csv("owl_world_gbr.csv", fileEncoding = "UTF-8-BOM")
COVID_19_vac=read.csv("owl_world_gbr_vac.csv", fileEncoding = "UTF-8-BOM")#下載疫苗覆蓋率
# View(COVID_19)
# View(COVID_19_vac)#查看疫苗覆蓋欄位
names(COVID_19)#查看欄位名稱
COVID_19_part<-COVID_19[,c("X.3","X.4","X.5",
"X.6","X.7","X.26")]#保留欄位
COVID_19_vac_part<-COVID_19_vac[,c("X.2","X.10","X.11","X.12")]#保留日期、打一劑、二劑、三劑比例欄位
View(COVID_19_part)
View(COVID_19_vac_part)
names(COVID_19_part)<-c("date","total_vaccination","daily_vaccination",
"daily_vaccination_avg","die","population")
names(COVID_19_vac_part)<-c("date","people_vaccinated_per_hundred",
"people_fully_vaccinated_per_hundred",
"total_boosters_per_hundred")
COVID_19_part<-COVID_19_part[-1,]#刪除第一欄
COVID_19_vac_part<-COVID_19_vac_part[-1,]#刪除第一欄
# View(COVID_19_part)#再檢查欄位
# View(COVID_19_vac_part)#再檢查欄位
str(COVID_19_part)
str(COVID_19_vac_part)
COVID_19_part<-merge(COVID_19_part,COVID_19_vac_part,all=TRUE) #聯集合併
View(COVID_19_part)
str(COVID_19_part)
# #將格式改成日期格式及數字格式
COVID_19_part$date<-as.character(COVID_19_part$date)
COVID_19_part$date<-strptime(COVID_19_part$date,
"%Y-%m-%d",
tz=Sys.timezone())
COVID_19_part$date<-as.POSIXct(COVID_19_part$date)
COVID_19_part[4]
COVID_19_part$total_vaccination<-as.character(COVID_19_part$total_vaccination)#
COVID_19_part$daily_vaccination<-as.character(COVID_19_part$daily_vaccination)#
COVID_19_part$daily_vaccination_avg<-as.character(COVID_19_part$daily_vaccination_avg)#
COVID_19_part$die<-as.character(COVID_19_part$die)
COVID_19_part$population<-as.character(COVID_19_part$population)
COVID_19_part$people_vaccinated_per_hundred<-as.character(COVID_19_part$people_vaccinated_per_hundred)
COVID_19_part$people_fully_vaccinated_per_hundred<-as.character(COVID_19_part$people_fully_vaccinated_per_hundred)
COVID_19_part$total_boosters_per_hundred<-as.character(COVID_19_part$total_boosters_per_hundred)
COVID_19_part$total_vaccination<-as.numeric(gsub(",","", COVID_19_part$total_vaccination))#
COVID_19_part$daily_vaccination<-as.numeric(gsub(",","", COVID_19_part$daily_vaccination))#
COVID_19_part$daily_vaccination_avg<-as.numeric(gsub(",","", COVID_19_part$daily_vaccination_avg))#
COVID_19_part$die<-as.numeric(gsub(",","", COVID_19_part$die))
COVID_19_part$population<-as.numeric(gsub(",","", COVID_19_part$population))
COVID_19_part$people_vaccinated_per_hundred<-as.numeric(gsub(",","", COVID_19_part$people_vaccinated_per_hundred))
COVID_19_part$people_fully_vaccinated_per_hundred<-as.numeric(gsub(",","", COVID_19_part$people_fully_vaccinated_per_hundred))
COVID_19_part$total_boosters_per_hundred<-as.numeric(gsub(",","", COVID_19_part$total_boosters_per_hundred))
str(COVID_19_part)#檢查格式正確與否
View(COVID_19_part)
COVID_19_part_2022<-subset(COVID_19_part,date<="2021-02-01 CST"
&date>="2021-12-31 CST")
View(COVID_19_part_2022)#最新的日期的資料
##劃圖累計
dev.new()
ggplot()+
geom_line(data=COVID_19_part_2022,#data.frame的資料
aes(x=date,y=daily_vaccination,
colour = "daily_vaccination"),size=1)+#折線
geom_line(data=COVID_19_part_2022,#data.frame的資料
aes(x=date,y=daily_vaccination_avg,
colour = "daily_vaccination_avg"),size=1)+
theme_bw()+
annotate("text" #標籤
,COVID_19_part_2022$date[which.min(COVID_19_part_2022$daily_vaccination_avg)]#自動找出最低的「七日平均新增確診」
,y=COVID_19_part_2022$daily_vaccination_avg[which.min(COVID_19_part_2022$daily_vaccination_avg)] # 自動找出最低「七日平均新增確診」y軸位置
,label=paste(COVID_19_part_2022$date[which.min(COVID_19_part_2022$daily_vaccination_avg)]
,"Lo"
,COVID_19_part_2022$daily_vaccination_avg[which.min(COVID_19_part_2022$daily_vaccination_avg)])
,colour="blue",size=3,vjust=1.5)+
annotate("text" #標籤
,COVID_19_part_2022$date[which.max(COVID_19_part_2022$daily_vaccination_avg)]#自動找出最高的「七日平均新增確診」
,y=COVID_19_part_2022$daily_vaccination_avg[which.max(COVID_19_part_2022$daily_vaccination_avg)] # 自動找出最高「七日平均新增確診」y軸位置
,label=paste(COVID_19_part_2022$date[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,"hi "
,COVID_19_part_2022$daily_vaccination_avg[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,"\n"
,"1st dose"
,COVID_19_part_2022$people_vaccinated_per_hundred[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,"%\n"
,"2nd dose"
,COVID_19_part_2022$people_fully_vaccinated_per_hundred[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,"%\n"
,"3rd dose"
,COVID_19_part_2022$total_boosters_per_hundred[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,"%\n"
,"accumlated comfirmed \namount at that time\n"
,round(COVID_19_part_2022$total_vaccination[which.max(COVID_19_part_2022$daily_vaccination_avg)]/
COVID_19_part_2022$population[which.max(COVID_19_part_2022$daily_vaccination_avg)],4)*100
,"%")
,colour="black",size=3,vjust=-1.0, hjust = 1)+
annotate("rect" #最低七日平均確診，到最高七日平均確診區間
,xmin=COVID_19_part_2022$date[which.min(COVID_19_part_2022$daily_vaccination_avg)]
,xmax=COVID_19_part_2022$date[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,ymin=COVID_19_part_2022$daily_vaccination_avg[which.min(COVID_19_part_2022$daily_vaccination_avg)]
,ymax=COVID_19_part_2022$daily_vaccination_avg[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,alpha=0.1,fill="blue")+
annotate("segment"
,x=COVID_19_part_2022$date[which.min(COVID_19_part_2022$daily_vaccination_avg)]
,xend=COVID_19_part_2022$date[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,y=COVID_19_part_2022$daily_vaccination_avg[which.min(COVID_19_part_2022$daily_vaccination_avg)]
,yend=COVID_19_part_2022$daily_vaccination_avg[which.max(COVID_19_part_2022$daily_vaccination_avg)]
,size=2,colour="yellow",arrow=arrow())+
ggtitle(paste("UK 2022 COVDI-19 "
,"daily_vaccination_avg"
,"Low to High increase"
,round(
COVID_19_part_2022$daily_vaccination_avg[which.max(COVID_19_part_2022$daily_vaccination_avg)]/
COVID_19_part_2022$daily_vaccination_avg[which.min(COVID_19_part_2022$daily_vaccination_avg)]-1,0)
,"times\n"
,"duration"
,interval(start = COVID_19_part_2022$date[which.min(COVID_19_part_2022$daily_vaccination_avg)]
,end = COVID_19_part_2022$date[which.max(COVID_19_part_2022$daily_vaccination_avg)]) / duration(num = 1, units = "days")
,"days"
,"current accumlated comfirmed amount"
,round(tail(COVID_19_part_2022$total_vaccination,1)/tail(COVID_19_part_2022$population,1),4)*100
,"%"))+
theme(plot.title = element_text(face="italic"
,colour = "red",hjust = 0.5,size = 15))#標題
